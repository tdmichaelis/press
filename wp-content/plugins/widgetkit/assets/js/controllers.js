angular.module("widgetkit").controller("contentCtrl",["$scope","Application","UIkit","Content",function(t,e,n,i){var o=this,a=window.localStorage||{};t.view="content",t.data=angular.extend({content:i.query()},e.config),o.name="contentCtrl",o.viewmode=a["wk.content.viewmode"]||"list",o.previewContent=function(e){return t.$emit("wk.preview.content",e).preview||t.data.types[e.type].icon},o.createContent=function(t){o.editContent({name:"",type:t.name,data:angular.extend({},t.data)})},o.editContent=function(e){t.view="contentEdit",t.content=angular.copy(e)},o.saveContent=function(){return i.save({id:t.content.id},{content:t.content},function(e){o.editContent(t.data.content[e.id]=e),n.notify(e.name+" saved.","success")})},o.deleteContent=function(e){confirm("Are you sure?")&&i["delete"]({id:e.id},function(){delete t.data.content[e.id]})},o.closeContent=function(){t.view="content"},o.setViewMode=function(t){o.viewmode=a["wk.content.viewmode"]=t},t.$watch("view",function(e){t.$emit("wk.change.view",e)})}]).controller("pickerCtrl",["$scope","Application","Content","UIkit",function(t,e,n,i){var o=this;t.view="content",t.data=angular.extend({},e.config),t.data.content=n.query(function(){t.selected=t.data.content[e.env.attrs.id],t.widget=t.data.widgets[e.env.attrs.widget],t.widget&&o.selectWidget(t.widget),e.env.modal.show()}),o.name="pickerCtrl",o.hasCustomWidgets=!1,Object.keys(t.data.widgets).forEach(function(e){t.data.widgets[e].core||(o.hasCustomWidgets=!0)}),o.createContent=function(t){o.editContent({name:"",type:t.name,data:angular.extend({},t.data)})},o.editContent=function(e){t.view="contentEdit",t.content=angular.copy(e||t.selected)},o.saveContent=function(){return n.save({id:t.content.id},{content:t.content},function(e){o.editContent(t.selected=t.data.content[e.id]=e),i.notify(e.name+" saved.","success")})},o.closeContent=function(){t.view="content"},o.listWidgets=function(){t.widget=null},o.selectWidget=function(n){t.widget=angular.copy(n),angular.isObject(n.settings)&&(t.widget.data=angular.extend({},n.settings),n.name==e.env.attrs.widget&&angular.extend(t.widget.data,e.env.attrs))},o.save=function(){var n={id:t.selected.id,widget:t.widget.name};angular.forEach(t.widget.data,function(e,i){t.widget.settings.hasOwnProperty(i)&&t.widget.settings[i]!=e&&(n[i]=e)}),e.env.update(n)},o.close=function(){e.env.cancel()}}]);