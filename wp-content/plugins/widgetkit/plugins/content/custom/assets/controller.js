angular.module("widgetkit").controller("customCtrl",["$scope","$timeout","UIkit","mediaInfo","mediaPicker","Fields","Application","Translator",function(e,t,i,n,o,d,a,l){e.content.data._fields||(e.content.data._fields=[]);var s,m=this,c=e.content.data._fields;e.content.data.items&&e.content.data.items.length||(e.content.data.items=[{media:""}]),s=e.content.data.items,e.item=s[0],e.extrafields=c,m.corefields=a.config.types.custom.fields,m.fields=d.fields(),m.previewItem=function(e){var t=e.options&&e.options.media&&e.options.media.poster;return n(t||e.media).image},m.addItem=function(t){e.item=t||{media:""},s.push(e.item)},m.importItems=function(){o.select({multiple:!0}).then(function(t){!t.length||1!=s.length||e.item.title&&e.item.media&&e.item.content||(s.length=0),angular.forEach(t,function(e){m.addItem({title:e.title,media:e.url,width:e.width,height:e.height})})})},m.editItem=function(t){e.item=t},m.deleteItem=function(t){s.splice(s.indexOf(t),1),e.item=s[0]},m.addField=function(e){return e=e||{type:"text",name:"field-x",label:"Field X"},m.corefields[e.name]&&(e.type=m.corefields[e.name].type,e.label=m.corefields[e.name].label),m.hasField(e.name)?void alert('Field name "'+e.name+'" is already in use.'):(s.forEach(function(t){t[e.name]||(t[e.name]="")}),void c.push(angular.copy(e)))},m.deleteField=function(e){confirm(l.trans("Are you sure you want to delete this field?"))&&(s.forEach(function(t){t[e.name]&&delete t[e.name]}),c.splice(c.indexOf(e),1))},m.hasField=function(e){if(["title","media","link"].indexOf(e)>-1)return!0;for(var t=0;t<c.length;t++)if(c[t].name==e)return!0;return!1},m.toggleEditFields=function(){m.editfields=!m.editfields,m.editfields||setTimeout(function(){window.dispatchEvent(new Event("resize"))},150),m.custom={field:{}},m.addCustomField=!1},m.getFieldOptions=function(e){var t={},i=m.corefields[e.name];return i&&i.options&&(t=angular.extend(t,i.options)),JSON.stringify(t)},e.$watch("content",function(t){var i=s.indexOf(e.item);s=t.data.items,e.item=s[i]}),i.$doc.trigger("ready.uk.dom"),i.$doc.on("change.uk.sortable",function(e,i,n){n&&void 0!==n&&(n=angular.element(n),t(function(){"js-content-items"==i.element[0].id&&s.splice(n.index(),0,s.splice(s.indexOf(n.scope().item),1)[0]),"js-fields-items"==i.element[0].id&&c.splice(n.index(),0,c.splice(c.indexOf(n.scope().field),1)[0])}))})}]).run(["$rootScope","mediaInfo",function(e,t){e.$on("wk.preview.content",function(e,i){if("custom"==i.type&&i.data.items.length){var n=i.data.items[0],o=n.options&&n.options.media&&n.options.media.poster;e.preview=t(o||n.media).image.replace(/preview(-.+\.svg)$/g,"content$1")}})}]);